---
title: 浏览器工作原理
date: 2018-08-28 16:38:05
tags: 浏览器
description: 简记浏览器工作原理
categories: 性能优化
keywords: 浏览器的工作原理
---
> 本文主要参考 [浏览器的工作原理：新式网络浏览器幕后揭秘](https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/#The_browser_main_functionality)
>
> 此文做学习记录

## 浏览器的高层结构
浏览器的主要组件：
- 用户界面 地址栏、前进后退、刷新按钮等（除了显示的页面外都是用户界面）
- 呈现引擎（负责显示页面）
- 浏览器引擎（在用户界面与呈现引擎间传达指令）
- 网络（用于网络调用，比如HTTP请求）
- 用户界面后端（用于绘制基本的窗口小部件，比如组合框和窗口）
- JavaScript解释器（解析、执行JavaScript）
- 存储（这是持久层，浏览器在硬盘存储数据，比如cookie等）

## 呈现引擎（渲染引擎）
> 默认情况，呈现引擎可以显示HTML、XML和图片，通过插件也可以显示其他类型的内容，比如PDF；
- Firefox使用的是Gecko
- Safari和Chrome使用的是WebKit

### 主流程
主流程可以参考 [重绘重排](https://littlefaye.gitee.io/teresa/2018/08/28/重绘重排/)

### 解析-综述
> `解析` 是 `呈现引擎` 中的一个重要环节。
> 
> `解析文档` 是指将文档转换成为有意义的结构。解析得到的结果通常是代表了文档结构的节点树，称作 `语法树` 或 `解析树` 。解析是以文档所遵循的语法规则为基础的。
#### 解析器和词法分析器的组合
解析的过程可以分为两个子过程： `词法分析` 和 `语法分析`

- 词法分析：将输入内容分割成大量标记的过程
- 语法分析：是应用语言的语法规则的过程

解析器通常将解析工作分给以下两个组件来处理：
- 词法分析器（标记生成器）：负责将内容分割成一个个的有效标记（词法分析器知道如何将无关字符比如空格、换行符分离出来）
- 解析器：负责根据语言语法规则分析文档结构，从而构建解析树

解析是一个迭代的过程。解析器想词法分析器请求一个新标记，并尝试将其与某条语法规则进行匹配。如果发现了匹配规则，解析器会将一个对应于该标记的节点添加到解析树，然后继续请求下一个标记。

如果没有规则可以匹配，解析器就会将标记存储到内部，并继续请求标记，直至找到所有内部存储的标记匹配的规则。如果找不到任何匹配规则。解析器就会引发一个异常。意味着文档无效，包含语法错误。
<div align="center">
  <img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image011.png" alt="源文档到解析树">
</div>

#### 翻译
很多时候，解析树不是最终产品。翻译是指将输入文档转换成另一种格式。编译就是一个例子。编译器可以将源代码编译成机器代码。
<div align="center">
  <img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image013.png" alt="编译流程">
</div>