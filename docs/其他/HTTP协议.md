---
title: HTTP协议
date: 2018-09-11 13:47:24
tags: HTTP
description: 读图解HTTP笔记
categories: HTTP
keywords: 读图解HTTP笔记
---
## web及网络基础
### 网路基础 `TCP/IP`
> 通常使用的网络是在 `TCP/IP` 协议族的基础上运作的。而 `HTTP` 属于他内部的一个子集

#### `TCP/IP` 协议族
> `TCP/IP` 是互联网相关的各类协议族的总称

#### `TCP/IP` 的分层管理
`TCP/IP` 协议族按层次分以下4层：
- 应用层
  - 应用层·应用层决定论向用户提供应用服务时通信的活动。
  - HTTP协议也处于该层
- 传输层
  - 提供处于网络连接中的两台计算机之间的数据传输
  - 传输层有两个性质不同的协议 `TCP` 和 `UDP`（用户数据报协议）
- 网络层
  - 用来处理在网络上流动的数据包。（数据包是网络传输的最小数据单位）
  - 该层规定了通过怎样的路径（所谓的传输路线）到达对方计算机，并把数据包传送给对方
- 数据链路层
  - 用来处理网络链接的硬件部分（物理可见部分）
  - 硬件上的范畴均在链路层的作用范围之内

#### `TCP/IP` 通信传输流
利用 `TCP/IP` 协议族进行网络通信时，会通过分层顺序与对方进行通信。发送端从应用层往下走，接收端从链路层网上走。

发送端在层与层之间传输数据时，没经过一层时必定会被打上一个该层所属的首部信息

反之，接收端在层与层传输数据时，每经过一层会把对应的首部消去

### `TCP` 、`IP`、`DNS`
#### 负责传输的 `IP` 协议

- IP网络协议位于网络层。作用是把各种数据包传递给对方(IP 与 IP地址 不是一回事)
- 若要保证确实传递给地方需要满足各类条件，其中两个重要的条件是 `IP地址` 和 `MAC地址`
  - IP地址 指明了节点被分配到的地址；IP地址 可变换；IP间的通信依赖MAC地址
  - MAC地址 是指网卡所属的固定地址；MAC地址 基本不会变换
  - ARP协议（address resolution protocol）是一种用以解析地址的协议，根据通信方的IP地址 就可以反查出对应 MAC地址；ARP协议凭借MAC地址进行通信

#### 确保可靠性的 `TCP协议`

- 按层次分，TCP位于传输层，提供可靠的字节流服务
  - 字节流服务：为了方便传输，将大块数据分割成以报文段为单位的数据包进行管理
  - 可靠的传输服务：能够把数据准确可靠的传给对方
- 为了准确无误将数据送至目标，TCP协议 采用了`三次握手策略`
- 握手过程使用了 TCP的标志 SYN（synchronize同步） 和 ACK（acknowledgement确认）
  - 发送端先发送一个带有 SYN 标志的数据包给接收端
  - 接收端收到后，回传一个带有 SYN/ACK 标志灯数据包以示传达确认信息
  - 发送端再回传一个带有 ACK 标志的数据包代表握手结束

### 负责域名解析的 DNS 服务
- DNS（domain name system）服务和HTTP协议一样位于应用层的协议；他提供域名到IP地址之间的解析服务

### 各种协议已HTTP协议的关系
![http](/teresa/images/HTTP.jpg)

### URI 和 URL
- URI 统一资源标识符；用字符串标识某一互联网资源
- URL 表示资源的地点；是URI的子集

## 简单的HTTP协议
### 请求和响应
- 请求报文（报文首部+报文主体）
  - 请求方法
  - 请求URI
  - 协议版本
  - 可选的请求首部字段（请求首部字段、通用首部字段、实体首部字段）
  - 内容实体

- 响应报文
  - 协议版本
  - 状态码
  - 解释状态码的短语
  - 可选的响应首部字段
  - 实体主体

### HTTP是不保存状态的协议

> HTTP协议是一种不保存状态，即无状态协议。HTTP协议自身不对请求和响应之间的通信状态进行保存。也就是说，在HTTP这个级别，协议对已发送过的请求或响应都不做持久化处理。
>
> 也是说，无法根据之前的状态进行本次的请求处理

### 告知服务器意图的 HTTP 方法
- GET 获取资源
- POST 传输实体主体
- PUT 传输文件
- HEAD 获得报文首部
- DELETE 删除文件（和 PUT 一样不带验证机制，所以一般的web网站不使用 delete 方法）
- OPTIONS 徐文支持的方法（查询URI指定资源支持的方法）
- CONNECT 要求用隧道协议链接代理
- TRACE 追踪路径

### 持久链接节省通信量
> HTTP 协议的初始版本汇总，每进行一次HTTP通信就要断开一次 TCP 链接。对于早时候的小容量文本传输这没有多大问题，但现在比如包含大量图片的网站，每次请求都会造成无谓的TCP链接建立和断开，增加通信量的开销。

为解决上述问题，HTTP/1.1 和 部分 HTTP/1.0 提出持久链接的 方法。

持久连接的特点是，只要任意一端没有明确提出断开连接，则保持 TCP 链接状态。旨在建立 1 次TCP链接后进行多次请求和响应的交互；

在 HTTP/1.1 中，所有的链接默认都是持久链接
> 管线化：持久连接使得多数请求以管线化方式发送成为可能。管线化技术出现，不用等待响应亦可直接发送下一个请求，实现并行发送多个请求

### 使用cookie的状态管理
## HTTP报文内的HTTP信息
### HTTP报文
> 用于HTTP协议交互的信息为 HTTP 报文；HTTP报文是有多行数据构成的字符串文本

## 返回结果的 HTTP 状态码
### 状态码类别
- 1xx （信息型状态码） 接受的请求正在处理
- 2xx （成功状态码）请求正常处理完毕
- 3xx （重定向状态码）需要进行附加操作以完成请求
- 4xx （客户端状态码）服务器无法处理请求
- 5xx （服务器错误状态码）服务器处理请求出错

### 2xx 成功
- 200 OK 请求成功
- 204 No Content 请求成功没有资源可返回
- 206 Partial Content

### 3xx 重定向
- 301 Moved Permanently 永久性重定向
- 302 Found 临时性重定向
- 303 See Other 表示请求的对应资源存在着另一个URL，应使用get方法定向获取资源
- 304 Not Modified 表示客户端发送附带条件的请求时，请求成功，但是不存在满足条件的资源时（改状态码和重定向没有关系）
- 307 Temporary Redirect 临时重定向，与302相同，但该状态严格按照标准不准post请求变成get

### 4xx 客户端错误
- 400 Bad Request 表示请求报文中存在语法错误
- 401 Unauthorized 表示发送的请求需要通过HTTP认证
- 403 Forbidden 表示对请求资源的访问被服务器拒绝了
- 404 Not Found 表明服务器无法找到请求资源

### 5xx 服务器错误
- 500 服务器端在执行请求时发送了错误
- 503 Server Unavailable 服务器处在超负荷或正在进行停机维护，无法处理请求

## 与 HTTP 协作的web服务器
### 用单台虚拟主机实现多个域名
即使物理层面只有一台服务器，但只要使用虚拟主机的功能。则可以奖项已具有多台服务器

### 通信数据转发程序：代理、网关、隧道
这些应用程序和服务器可以将请求转发给通信线路上的下一站服务器，并且能接受从那台服务器发送的响应再转给客户端
#### 代理 
代理服务器的基本行为就是接收客户端发送的请求后转发给其它服务器。代理不改变URI，会直接发送给出游资源的目标服务器。

在HTTP通信过程中。可级联多台代理服务器。转发时，需要附加Via首部字段以标记出经过的主机信息
#### 网关
利用网关，可以有HTTP请求转化为其它协议通信
#### 隧道
隧道可按要求建立起一条与其它服务器的通信线路，解释使用SSL等加密手段进行通信。隧道的目的是确保客户端能与服务器进行安全的通信。
## HTTP首部
### HTTP首部字段
> 使用首部字段是为了给浏览器和服务器提供报文主体大小，所使用语言、认证信息等内容。

## 确保web安全的HTTPS
### HTTP的缺点
- 通信使用明文（不加密），内容可能被窃听
- 不验证通信方的身份，有可能遭遇伪装
- 无法验证报文的完整性，所以有可能已遭篡改

### HTTP + 加密 + 认证 + 完整性保护 = HTTPS
#### 公开密钥加密技术
- 共享密钥加密
  - 加密和解密通用一个密钥的方式成为共享密钥加密（对称秘钥加密）
  - 以共享密钥的方式加密时必须将密钥也发给对方，期间也存在监听问题

- 使用两把密钥的公开密钥加密
  - 公开密钥加密使用一堆非对称的密钥；一个私有密钥，另一个叫公开密钥
  - 公开密钥加密与共享密钥加密相比，其处理速度要慢些

